(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{109:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return p})),n.d(t,"default",(function(){return s}));var a=n(3),r=n(7),l=(n(0),n(116)),o={title:"JavaScript tutorial",sidebar_label:"JavaScript",slug:"javascript"},i={unversionedId:"tutorials/javascript",id:"tutorials/javascript",isDocsHomePage:!1,title:"JavaScript tutorial",description:"Node.js can be used to build standalone web apps and dashboards or add web UI to existing scripts, jobs.",source:"@site/docs/tutorials/javascript.md",slug:"/tutorials/javascript",permalink:"/docs/tutorials/javascript",editUrl:"https://github.com/pglet/website/edit/master/docs/tutorials/javascript.md",version:"current",sidebar_label:"JavaScript",sidebar:"someSidebar",previous:{title:"PowerShell tutorial",permalink:"/docs/tutorials/powershell"},next:{title:"Pglet Service",permalink:"/docs/pglet-service"}},p=[{value:"Installing <code>pglet</code> module",id:"installing-pglet-module",children:[]},{value:"Creating a page",id:"creating-a-page",children:[]},{value:"Getting user input",id:"getting-user-input",children:[]},{value:"Handling events",id:"handling-events",children:[{value:"Event loop",id:"event-loop",children:[]}]},{value:"Multi-user apps",id:"multi-user-apps",children:[]},{value:"Getting apps and pages to the Web",id:"getting-apps-and-pages-to-the-web",children:[]},{value:"<code>pglet</code> module reference",id:"pglet-module-reference",children:[{value:"<code>page</code> function",id:"page-function",children:[]},{value:"<code>app</code> function",id:"app-function",children:[]},{value:"<code>Connection</code> class",id:"connection-class",children:[]},{value:"<code>Event</code> class",id:"event-class",children:[]}]}],c={toc:p};function s(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(l.b)("wrapper",Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(l.b)("p",null,"Node.js can be used to build standalone web apps and dashboards or add web UI to existing scripts, jobs."),Object(l.b)("h2",{id:"installing-pglet-module"},"Installing ",Object(l.b)("inlineCode",{parentName:"h2"},"pglet")," module"),Object(l.b)("p",null,"Requirements:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Node 8 or above on Windows, Linux or macOS")),Object(l.b)("p",null,"To install ",Object(l.b)("inlineCode",{parentName:"p"},"pglet")," module run the following command:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"npm install pglet\n")),Object(l.b)("h2",{id:"creating-a-page"},"Creating a page"),Object(l.b)("p",null,"Pglet allows you creating ",Object(l.b)("strong",{parentName:"p"},"shared")," and ",Object(l.b)("strong",{parentName:"p"},"app")," pages."),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"Shared page")," is like a singleton: many programs can connect and author the same page and all web users connecting to a page see and interact with the same content. Shared pages are useful for developing local tools, web dashboards, progress reports, distributed processes visualization, etc. "),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"App page"),' creates for each web user a new session with its own content. In your program you define a "handler" method which is invoked for every new session. App pages are used for creating multi-user web apps.'),Object(l.b)("p",null,'OK, this is a minimal "Hello world" Pglet page running in a local mode:'),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript",metastring:'title="hello.js"',title:'"hello.js"'}),'const pglet = require("pglet");\n\n(async () => {\n    let p = await pglet.page("hello");\n    await p.send("add text value=\'Hello, world!\'");\n})();\n')),Object(l.b)("p",null,"When you run this app a new browser window should popup with the greeting:"),Object(l.b)("div",{style:{textAlign:"center"}},Object(l.b)("img",{src:"/img/docs/quickstart-hello-world.png"})),Object(l.b)("p",null,"A Node app won't wait for any input and should exit. Now, if you run the same ",Object(l.b)("inlineCode",{parentName:"p"},"hello.js"),' script for the second time another "Hello, world!" message will be added to the page. This is because the page is stateful. Its contents can be updated at any time by any number of scripts, multiple scripts can connect and update the same page simultanously.'),Object(l.b)("p",null,"If you need a clean page on every start of the program use connection's ",Object(l.b)("inlineCode",{parentName:"p"},"clean()")," method:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'await p.send("clean");\nawait p.send("add text value=\'Hello, world!\'");\n')),Object(l.b)("h2",{id:"getting-user-input"},"Getting user input"),Object(l.b)("p",null,"Pglet provides a number of controls for building forms: ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/reference/controls/textbox"}),"Textbox"),", ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/reference/controls/checkbox"}),"Checkbox"),", ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/reference/controls/dropdown"}),"Dropdown"),", ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/reference/controls/button"}),"Button"),"."),Object(l.b)("p",null,"Let's ask a user for a name:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript",metastring:'title="greeter.js"',title:'"greeter.js"'}),'const pglet = require("pglet");\n\n(async () => {\n    let p = await pglet.page("greeter");\n    let txt_name = await p.send("add textbox label=\'Your name\' description=\'Please provide your full name\'");\n    let btn_hello = await p.send("add button primary text=\'Say hello\'");\n})();\n')),Object(l.b)("h2",{id:"handling-events"},"Handling events"),Object(l.b)("p",null,'When you click "Say hello" button on the form above nothing will happen in our program though ',Object(l.b)("inlineCode",{parentName:"p"},"Button"),' control itself emits "click" event each time it\'s pressed/clicked. The event is just not handled.'),Object(l.b)("p",null,"In Node.js Pglet app you use event loop to handle control events."),Object(l.b)("h3",{id:"event-loop"},"Event loop"),Object(l.b)("p",null,"Once the form is rendered use ",Object(l.b)("inlineCode",{parentName:"p"},"await p.waitEvent()")," method in a loop to receive all page events triggered by a user:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript",metastring:'title="greeter.js"',title:'"greeter.js"'}),"const pglet = require(\"pglet\");\n\n(async () => {\n    let p = await pglet.page(\"greeter\");\n\n    let txt_name = await p.send(\"add textbox label='Your name' description='Please provide your full name'\");\n    let btn_hello = await p.send(\"add button primary text='Say hello'\");\n    \n    while(true) {\n        const e = await p.waitEvent();\n        if (e.target === btn_hello && e.name === 'click') {\n            let name = await p.send(`get ${txt_name} value`);\n            await p.send(\"clean page\");\n            await p.send(`add text value='Hello, ${name}!'`);\n        }\n    }\n})();\n")),Object(l.b)("p",null,"Notice how IDs of the added textbox and button are saved, so we can refer to these controls later."),Object(l.b)("p",null,Object(l.b)("inlineCode",{parentName:"p"},"waitEvent()")," returns ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"#event-class"}),"Event")," object and we are interested in ",Object(l.b)("inlineCode",{parentName:"p"},"click")," events coming from the button (",Object(l.b)("inlineCode",{parentName:"p"},"e.target")," is control's ID). Next, we use ",Object(l.b)("inlineCode",{parentName:"p"},"get")," command to read ",Object(l.b)("inlineCode",{parentName:"p"},"value")," property of textbox control, ",Object(l.b)("inlineCode",{parentName:"p"},"clean")," the page, output greeting and leave the program."),Object(l.b)("h2",{id:"multi-user-apps"},"Multi-user apps"),Object(l.b)("p",null,"In multi-user Pglet apps every user has a unique session with its own page contents. To start an app page you use ",Object(l.b)("inlineCode",{parentName:"p"},"pglet.app()")," method which takes a reference to a session handler function. The handler function is called for every new user connected with connection object in parameters. The program stays blocked on ",Object(l.b)("inlineCode",{parentName:"p"},"pglet.app()")," while constantly waiting for new user connections."),Object(l.b)("p",null,"This could be a minimal Pglet multi-user app in Node.js:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript",metastring:'title="hello-app.js"',title:'"hello-app.js"'}),'const pglet = require("pglet");\n\n(async () => {\n    await pglet.app("hello-app", async (p) => {\n\n        await p.send("clean");\n        await p.send("add text value=\'Hello, world!\'");\n    });\n\n    process.stdin.resume();\n})();\n')),Object(l.b)("p",null,"Now, a multi-user version of greeter app could look like the following:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript",metastring:'title="greeter-app.js"',title:'"greeter-app.js"'}),"const pglet = require(\"pglet\");\n\n(async () => {\n\n    // start a new session for every user visit\n    await pglet.app(\"greeter-app\", async (p) => {\n\n        // add textbox and a button\n        let txt_name = await p.send(\"add textbox label='Your name' description='Please provide your full name'\");\n        let btn_hello = await p.send(\"add button primary text='Say hello'\");\n        \n        while(true) {\n            // wait until button is clicked\n            const e = await p.waitEvent();\n            if (e.target === btn_hello && e.name === 'click') {\n\n                // get the entered value of a textbox\n                let name = await p.send(`get ${txt_name} value`);\n\n                // clean the page and output the greeting\n                await p.send(\"clean page\");\n                await p.send(`add text value='Hello, ${name}!'`);\n            }\n        }\n    });\n\n    process.stdin.resume();\n})();\n")),Object(l.b)("h2",{id:"getting-apps-and-pages-to-the-web"},"Getting apps and pages to the Web"),Object(l.b)("p",null,"Up until this moment you've been running all tutotial samples on your computer with a local Pglet server instance running in the background."),Object(l.b)("p",null,"With literarily no changes to the code Pglet allows to make your program accessible from the web. This could be an admin app for managing backend services, or a dashboard with server metrics, or an application prototype you are sharing with your colleagues or clients."),Object(l.b)("p",null,'In contrast to a classic deployment you are not packaging your program and it\'s not going anywhere. It continues to run on the same computer where it was built or cloned while UI is "streamed" to ',Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/pglet-service"}),"Pglet service")," and available via ",Object(l.b)("inlineCode",{parentName:"p"},"https://app.pglet.io/public/{your-app-name}")," URL."),Object(l.b)("p",null,"So, to make your greeter app available on the web add ",Object(l.b)("inlineCode",{parentName:"p"},"{web: true}")," options to either ",Object(l.b)("inlineCode",{parentName:"p"},"pglet.page()")," or ",Object(l.b)("inlineCode",{parentName:"p"},"pglet.app()")," call:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'await pglet.app("greeter-app", {web: true}, async (p) => { /* ... */ })\n')),Object(l.b)("p",null,'As it\'s going to a public service the page name must be unique. One way is to prepend page name with "account" or "namespace", for example:'),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),'await pglet.app("john/greeter-app", {web: true}, async (p) => { /* ... */ })\n')),Object(l.b)("p",null,"or just omit page name, so it will be randomly generated. Look at ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/pglet-service"}),"this article")," to understand how page naming works."),Object(l.b)("h2",{id:"pglet-module-reference"},Object(l.b)("inlineCode",{parentName:"h2"},"pglet")," module reference"),Object(l.b)("h3",{id:"page-function"},Object(l.b)("inlineCode",{parentName:"h3"},"page")," function"),Object(l.b)("p",null,Object(l.b)("inlineCode",{parentName:"p"},"pglet.page(name, options)")),Object(l.b)("p",null,"Creates a shared page if not exists and returns a ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"#connection-class"}),"connection")," to it."),Object(l.b)("p",null,"Parameters:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"name")," - the name of app in the form ",Object(l.b)("inlineCode",{parentName:"li"},"{account}/{page_name}"),". The name will be auto-generated if left blank."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"options")," - app creation options object with the following properties:",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"web")," (bool) - make app UI available on the web."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"noWindow")," (bool) - do not open browser window."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"server")," (string) - URL of the self-hosted Pglet server to run the app on."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"token")," (string) - authentication token for self-hosted server.")))),Object(l.b)("h3",{id:"app-function"},Object(l.b)("inlineCode",{parentName:"h3"},"app")," function"),Object(l.b)("p",null,Object(l.b)("inlineCode",{parentName:"p"},"pglet.app(name, options, sessionCallback)")),Object(l.b)("p",null,"Creates an app page with a session handler function defined by ",Object(l.b)("inlineCode",{parentName:"p"},"sessionCallback")," parameter and starts waiting for new user connections.\nHandler function is called for every new session with ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"#connection-class"}),"connection")," passed into handler."),Object(l.b)("p",null,"Parameters:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"name")," - the name of app in the form ",Object(l.b)("inlineCode",{parentName:"li"},"{account}/{page_name}"),". The name will be auto-generated if left blank."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"options")," - app creation options object with the following properties:",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"web")," (bool) - make app UI available on the web."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"noWindow")," (bool) - do not open browser window."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"server")," (string) - URL of the self-hosted Pglet server to run the app on."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"token")," (string) - authentication token for self-hosted server."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"sessionCallback")," - callback function for handling a session. ",Object(l.b)("a",Object(a.a)({parentName:"li"},{href:"#connection-class"}),"Connection")," is passed as an argument.")),Object(l.b)("h3",{id:"connection-class"},Object(l.b)("inlineCode",{parentName:"h3"},"Connection")," class"),Object(l.b)("p",null,"Represents a connection to a page or session. ",Object(l.b)("inlineCode",{parentName:"p"},"Connection")," provides methods for adding, modifying, querying and removing controls on a web page."),Object(l.b)("h4",{id:"sendcommand"},Object(l.b)("inlineCode",{parentName:"h4"},"send(command)")),Object(l.b)("p",null,"Sends a raw command to Pglet server via ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/reference/protocol"}),"Pglet protocol"),"."),Object(l.b)("p",null,"For example, to update ",Object(l.b)("inlineCode",{parentName:"p"},"errorMessage")," property of textbox with ID ",Object(l.b)("inlineCode",{parentName:"p"},"number"),":"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"await page.send(\"set number errorMessage='Some error message'\")\n")),Object(l.b)("h4",{id:"waitevent"},Object(l.b)("inlineCode",{parentName:"h4"},"waitEvent()")),Object(l.b)("p",null,"Blocks until an event triggered by a user received. The method returns an instance of ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"#event-class"}),"Event")," class."),Object(l.b)("p",null,"For example, reading events in a loop until any button clicked:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"while(true) {\n  let e = await page.waitEvent()\n  if e.name === 'click' {\n    break\n  }\n}\n")),Object(l.b)("h3",{id:"event-class"},Object(l.b)("inlineCode",{parentName:"h3"},"Event")," class"),Object(l.b)("p",null,"Describes the details of event returned by ",Object(l.b)("inlineCode",{parentName:"p"},"waitEvent()")," method and has the following properties:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"target")," - ID of control triggered event."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"name"),' - event name, for example "click".'),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"data")," - additional data attached to the event. Button control has ",Object(l.b)("inlineCode",{parentName:"li"},"data")," property which supplies additional event data.")))}s.isMDXComponent=!0},116:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),s=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},b=function(e){var t=s(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),b=s(n),u=a,m=b["".concat(o,".").concat(u)]||b[u]||d[u]||l;return n?r.a.createElement(m,i(i({ref:t},c),{},{components:n})):r.a.createElement(m,i({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,o=new Array(l);o[0]=u;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var c=2;c<l;c++)o[c]=n[c];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);